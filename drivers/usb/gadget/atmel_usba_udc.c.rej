--- drivers/usb/gadget/atmel_usba_udc.c
+++ drivers/usb/gadget/atmel_usba_udc.c
@@ -2015,6 +2016,9 @@
 			} else {
 				disable_irq(gpio_to_irq(udc->vbus_pin));
 			}
+		} else {
+			/* gpio_request fail so use -EINVAL for gpio_is_valid */
+			udc->vbus_pin = -EINVAL;
 		}
 	}
 
